# AutoCJK

AutoCJK is a tool for generating low-resolution predictions of uncommon CJK
characters, given full-width images of their components.

Example:

![U+20E74](docs/images/0x134772.png)

(Left-to-right: (a) source left-hand component, (b) source right-hand component,
(c) expected composition, (d) predicted composition, (e) c/d difference)

## Quickstart

* First clone this repo. 

  ```bash
  git clone git@github.com:google/autocjk.git
  ```

* You will also need to install [git-lfs](https://git-lfs.github.com/) to
  download the large generator files.

  ```bash
  sudo apt-get install git-lfs
  git lfs pull
  ```

* You will also need `pip3>=19.0` in order to install `tensorflow>=2.3.0`. 
  This part is finicky and should be done manually, not through bazel pip 
  requirements.

  ```bash
  pip3 install --upgrade pip
  pip3 install "tensorflow>=2.3.0"
  ```

* You will also need
  [Harfbuzz](https://harfbuzz.github.io/install-harfbuzz.html) for font shaping.

  ```bash
  sudo apt-get install libharfbuzz-bin
  ```

### How do I generate a new character?

For example, given a font at `~/Downloads/font.otf`, we can render `⿰市來` and
write the generated image to `/tmp/out.png` with:

```
bazel run //src:main -- \
  --font_path=<path_to_font> \
  --lhs='市' \
  --rhs='來' \
  --out=/tmp/out.png
```

## Usage guide:

Bundled with this repo is `/src/generator.h5`, a trained model with pretty good
results. This generator was trained on ~270k image pairs, generated by
extracting characters from the fonts `NotoSansCJKsc-*` and `NotoSerifCJKsc-*`.

The resultant generator is pretty good at generating characters in that style.
It might even be pretty good at generating characters in a new style. If you
discover it's not, you can (a) generate a new batch of training images in your
own font style, and (b) run `model.py` in order to train a new model. If you
save that model as `src/generator.h5`, you can continue to use `bazel run //src:main` as expected.

## Development:

1. Run tests, autoformatting, etc. before submitting.

   ```bash
   bazel test ...
   # pip install yapf
   yapf -i src/**.py
   # pip install mdformat
   find . -iname 'README.md' | xargs mdformat
   ```
